var updateQueryString=require("./util/update-query-string");module.exports=function(location,options,callback){var queryString,requestOptions=(options=options||{}).requestOptions||{},requestMethod=(requestOptions.requestMethod||"GET").toUpperCase(),requestParams=requestOptions.requestParams||null,formData=requestOptions.formData||null,requestPayload=null,request=new XMLHttpRequest,timeout=options.timeout||0;if(request.onreadystatechange=function(){4===request.readyState&&(200===request.status?callback(request.responseText,request,location,options):0!==request.status&&callback(null,request,location,options))},request.onerror=function(e){console.log(e),callback(null,request,location,options)},request.ontimeout=function(){callback(null,request,location,options)},requestParams&&requestParams.length)switch(queryString=requestParams.map((function(param){return param.name+"="+param.value})).join("&"),requestMethod){case"GET":location=location.split("?")[0],location+="?"+queryString;break;case"POST":requestPayload=queryString}else formData&&(requestPayload=formData);return options.cacheBust&&(location=updateQueryString(location,"t",Date.now())),request.open(requestMethod,location,!0),request.timeout=timeout,request.setRequestHeader("X-Requested-With","XMLHttpRequest"),request.setRequestHeader("X-PJAX","true"),request.setRequestHeader("X-PJAX-Selectors",JSON.stringify(options.selectors)),requestPayload&&"POST"===requestMethod&&!formData&&request.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),request.send(requestPayload),request};