var on=require("../events/on"),clone=require("../util/clone"),attrState="data-pjax-state",formAction=function(el,event){if(!isDefaultPrevented(event)){var options=clone(this.options);options.requestOptions={requestUrl:el.getAttribute("action")||window.location.href,requestMethod:el.getAttribute("method")||"GET"};var virtLinkElement=document.createElement("a");virtLinkElement.setAttribute("href",options.requestOptions.requestUrl);var attrValue=checkIfShouldAbort(virtLinkElement,options);attrValue?el.setAttribute(attrState,attrValue):(event.preventDefault(),"multipart/form-data"===el.enctype?options.requestOptions.formData=new FormData(el):options.requestOptions.requestParams=parseFormElements(el),el.setAttribute(attrState,"submit"),options.triggerElement=el,this.loadUrl(virtLinkElement.href,options))}};function parseFormElements(el){for(var requestParams=[],formElements=el.elements,i=0;i<formElements.length;i++){var element=formElements[i],tagName=element.tagName.toLowerCase();if(element.name&&void 0!==element.attributes&&"button"!==tagName){var type=element.attributes.type;if(!type||"checkbox"!==type.value&&"radio"!==type.value||element.checked){var values=[];if("select"===tagName)for(var opt,j=0;j<element.options.length;j++)(opt=element.options[j]).selected&&!opt.disabled&&values.push(opt.hasAttribute("value")?opt.value:opt.text);else values.push(element.value);for(var k=0;k<values.length;k++)requestParams.push({name:encodeURIComponent(element.name),value:encodeURIComponent(values[k])})}}}return requestParams}function checkIfShouldAbort(virtLinkElement,options){return virtLinkElement.protocol!==window.location.protocol||virtLinkElement.host!==window.location.host?"external":virtLinkElement.hash&&virtLinkElement.href.replace(virtLinkElement.hash,"")===window.location.href.replace(location.hash,"")?"anchor":virtLinkElement.href===window.location.href.split("#")[0]+"#"?"anchor-empty":options.currentUrlFullReload&&virtLinkElement.href===window.location.href.split("#")[0]?"reload":void 0}var isDefaultPrevented=function(event){return event.defaultPrevented||!1===event.returnValue};module.exports=function(el){var that=this;el.setAttribute(attrState,""),on(el,"submit",(function(event){formAction.call(that,el,event)}))};