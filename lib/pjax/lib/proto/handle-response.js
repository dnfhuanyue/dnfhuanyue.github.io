var clone=require("../util/clone"),newUid=require("../uniqueid"),trigger=require("../events/trigger");module.exports=function(responseText,request,href,options){if((options=clone(options||this.options)).request=request,!1!==responseText){var currentState=window.history.state||{};window.history.replaceState({url:currentState.url||window.location.href,title:currentState.title||document.title,uid:currentState.uid||newUid(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var oldHref=href;request.responseURL?href!==request.responseURL&&(href=request.responseURL):request.getResponseHeader("X-PJAX-URL")?href=request.getResponseHeader("X-PJAX-URL"):request.getResponseHeader("X-XHR-Redirected-To")&&(href=request.getResponseHeader("X-XHR-Redirected-To"));var a=document.createElement("a");a.href=oldHref;var oldHash=a.hash;a.href=href,oldHash&&!a.hash&&(a.hash=oldHash,href=a.href),this.state.href=href,this.state.options=options;try{this.loadContent(responseText,options)}catch(e){if(trigger(document,"pjax:error",options),this.options.debug)throw e;return console&&console.error&&console.error("Pjax switch fail: ",e),this.latestChance(href)}}else trigger(document,"pjax:complete pjax:error",options)};