!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Pjax=f()}}((function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var forEachEls=require("./lib/foreach-els"),parseOptions=require("./lib/parse-options"),switches=require("./lib/switches"),newUid=require("./lib/uniqueid"),on=require("./lib/events/on"),trigger=require("./lib/events/trigger"),clone=require("./lib/util/clone"),contains=require("./lib/util/contains"),extend=require("./lib/util/extend"),noop=require("./lib/util/noop"),Pjax=function(options){this.state={numPendingSwitches:0,href:null,options:null},this.options=parseOptions(options),this.log("Pjax options",this.options),this.options.scrollRestoration&&"scrollRestoration"in history&&(history.scrollRestoration="manual"),this.maxUid=this.lastUid=newUid(),this.parseDOM(document),on(window,"popstate",function(st){if(st.state){var opt=clone(this.options);opt.url=st.state.url,opt.title=st.state.title,opt.history=!1,opt.scrollPos=st.state.scrollPos,st.state.uid<this.lastUid?opt.backward=!0:opt.forward=!0,this.lastUid=st.state.uid,this.loadUrl(st.state.url,opt)}}.bind(this))};if(Pjax.switches=switches,Pjax.prototype={log:require("./lib/proto/log"),getElements:function(el){return el.querySelectorAll(this.options.elements)},parseDOM:function(el){var parseElement=require("./lib/proto/parse-element");forEachEls(this.getElements(el),parseElement,this)},refresh:function(el){this.parseDOM(el||document)},reload:function(){window.location.reload()},attachLink:require("./lib/proto/attach-link"),attachForm:require("./lib/proto/attach-form"),forEachSelectors:function(cb,context,DOMcontext){return require("./lib/foreach-selectors").bind(this)(this.options.selectors,cb,context,DOMcontext)},switchSelectors:function(selectors,fromEl,toEl,options){return require("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,selectors,fromEl,toEl,options)},latestChance:function(href){window.location=href},onSwitch:function(){trigger(window,"resize scroll"),this.state.numPendingSwitches--,0===this.state.numPendingSwitches&&this.afterAllSwitches()},loadContent:function(html,options){if("string"==typeof html){var tmpEl=document.implementation.createHTMLDocument("pjax"),matches=html.match(/<html[^>]+>/gi);if(matches&&matches.length&&(matches=matches[0].match(/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi)).length&&(matches.shift(),matches.forEach((function(htmlAttrib){var attr=htmlAttrib.trim().split("=");1===attr.length?tmpEl.documentElement.setAttribute(attr[0],!0):tmpEl.documentElement.setAttribute(attr[0],attr[1].slice(1,-1))}))),tmpEl.documentElement.innerHTML=html,this.log("load content",tmpEl.documentElement.attributes,tmpEl.documentElement.innerHTML.length),document.activeElement&&contains(document,this.options.selectors,document.activeElement))try{document.activeElement.blur()}catch(e){}this.switchSelectors(this.options.selectors,tmpEl,document,options)}else trigger(document,"pjax:complete pjax:error",options)},abortRequest:require("./lib/abort-request"),doRequest:require("./lib/send-request"),handleResponse:require("./lib/proto/handle-response"),loadUrl:function(href,options){options="object"==typeof options?extend({},this.options,options):clone(this.options),this.log("load href",href,options),this.abortRequest(this.request),trigger(document,"pjax:send",options),this.request=this.doRequest(href,options,this.handleResponse.bind(this))},afterAllSwitches:function(){var autofocusEl=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();autofocusEl&&document.activeElement!==autofocusEl&&autofocusEl.focus(),this.options.selectors.forEach((function(selector){forEachEls(document.querySelectorAll(selector),(function(el){}))}));var state=this.state;if(state.options.history&&(window.history.state||(this.lastUid=this.maxUid=newUid(),window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)),this.lastUid=this.maxUid=newUid(),window.history.pushState({url:state.href,title:state.options.title,uid:this.maxUid,scrollPos:[0,0]},state.options.title,state.href)),this.forEachSelectors((function(el){this.parseDOM(el)}),this),trigger(document,"pjax:complete pjax:success",state.options),"function"==typeof state.options.analytics&&state.options.analytics(),state.options.history){var a=document.createElement("a");if(a.href=this.state.href,a.hash){var name=a.hash.slice(1);name=decodeURIComponent(name);var curtop=0,target=document.getElementById(name)||document.getElementsByName(name)[0];if(target&&target.offsetParent)do{curtop+=target.offsetTop,target=target.offsetParent}while(target);window.scrollTo(0,curtop)}else!1!==state.options.scrollTo&&(state.options.scrollTo.length>1?window.scrollTo(state.options.scrollTo[0],state.options.scrollTo[1]):window.scrollTo(0,state.options.scrollTo))}else state.options.scrollRestoration&&state.options.scrollPos&&window.scrollTo(state.options.scrollPos[0],state.options.scrollPos[1]);this.state={numPendingSwitches:0,href:null,options:null}}},Pjax.isSupported=require("./lib/is-supported"),Pjax.isSupported())module.exports=Pjax;else{var stupidPjax=noop;for(var key in Pjax.prototype)Pjax.prototype.hasOwnProperty(key)&&"function"==typeof Pjax.prototype[key]&&(stupidPjax[key]=noop);module.exports=stupidPjax}},{"./lib/abort-request":2,"./lib/events/on":3,"./lib/events/trigger":4,"./lib/foreach-els":5,"./lib/foreach-selectors":6,"./lib/is-supported":7,"./lib/parse-options":8,"./lib/proto/attach-form":9,"./lib/proto/attach-link":10,"./lib/proto/handle-response":11,"./lib/proto/log":12,"./lib/proto/parse-element":13,"./lib/send-request":14,"./lib/switches":16,"./lib/switches-selectors":15,"./lib/uniqueid":17,"./lib/util/clone":18,"./lib/util/contains":19,"./lib/util/extend":20,"./lib/util/noop":21}],2:[function(require,module,exports){var noop=require("./util/noop");module.exports=function(request){request&&request.readyState<4&&(request.onreadystatechange=noop,request.abort())}},{"./util/noop":21}],3:[function(require,module,exports){var forEachEls=require("../foreach-els");module.exports=function(els,events,listener,useCapture){(events="string"==typeof events?events.split(" "):events).forEach((function(e){forEachEls(els,(function(el){el.addEventListener(e,listener,useCapture)}))}))}},{"../foreach-els":5}],4:[function(require,module,exports){var forEachEls=require("../foreach-els");module.exports=function(els,events,opts){(events="string"==typeof events?events.split(" "):events).forEach((function(e){var event;(event=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),event.eventName=e,opts&&Object.keys(opts).forEach((function(key){event[key]=opts[key]})),forEachEls(els,(function(el){var domFix=!1;el.parentNode||el===document||el===window||(domFix=!0,document.body.appendChild(el)),el.dispatchEvent(event),domFix&&el.parentNode.removeChild(el)}))}))}},{"../foreach-els":5}],5:[function(require,module,exports){module.exports=function(els,fn,context){return els instanceof HTMLCollection||els instanceof NodeList||els instanceof Array?Array.prototype.forEach.call(els,fn,context):fn.call(context,els)}},{}],6:[function(require,module,exports){var forEachEls=require("./foreach-els");module.exports=function(selectors,cb,context,DOMcontext){DOMcontext=DOMcontext||document,selectors.forEach((function(selector){forEachEls(DOMcontext.querySelectorAll(selector),cb,context)}))}},{"./foreach-els":5}],7:[function(require,module,exports){module.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],8:[function(require,module,exports){var defaultSwitches=require("./switches");function defaultAnalytics(){window._gaq&&_gaq.push(["_trackPageview"]),window.ga&&ga("send","pageview",{page:location.pathname,title:document.title})}module.exports=function(options){return(options=options||{}).elements=options.elements||"a[href], form[action]",options.selectors=options.selectors||["title",".js-Pjax"],options.switches=options.switches||{},options.switchesOptions=options.switchesOptions||{},options.history=void 0===options.history||options.history,options.analytics="function"==typeof options.analytics||!1===options.analytics?options.analytics:defaultAnalytics,options.scrollTo=void 0===options.scrollTo?0:options.scrollTo,options.scrollRestoration=void 0===options.scrollRestoration||options.scrollRestoration,options.cacheBust=void 0===options.cacheBust||options.cacheBust,options.debug=options.debug||!1,options.timeout=options.timeout||0,options.currentUrlFullReload=void 0!==options.currentUrlFullReload&&options.currentUrlFullReload,options.switches.head||(options.switches.head=defaultSwitches.switchElementsAlt),options.switches.body||(options.switches.body=defaultSwitches.switchElementsAlt),options}},{"./switches":16}],9:[function(require,module,exports){var on=require("../events/on"),clone=require("../util/clone"),formAction=function(el,event){if(!isDefaultPrevented(event)){var options=clone(this.options);options.requestOptions={requestUrl:el.getAttribute("action")||window.location.href,requestMethod:el.getAttribute("method")||"GET"};var virtLinkElement=document.createElement("a");virtLinkElement.setAttribute("href",options.requestOptions.requestUrl);var attrValue=function checkIfShouldAbort(virtLinkElement,options){if(virtLinkElement.protocol!==window.location.protocol||virtLinkElement.host!==window.location.host)return"external";if(virtLinkElement.hash&&virtLinkElement.href.replace(virtLinkElement.hash,"")===window.location.href.replace(location.hash,""))return"anchor";if(virtLinkElement.href===window.location.href.split("#")[0]+"#")return"anchor-empty";if(options.currentUrlFullReload&&virtLinkElement.href===window.location.href.split("#")[0])return"reload"}(virtLinkElement,options);attrValue?el.setAttribute("data-pjax-state",attrValue):(event.preventDefault(),"multipart/form-data"===el.enctype?options.requestOptions.formData=new FormData(el):options.requestOptions.requestParams=function parseFormElements(el){for(var requestParams=[],formElements=el.elements,i=0;i<formElements.length;i++){var element=formElements[i],tagName=element.tagName.toLowerCase();if(element.name&&void 0!==element.attributes&&"button"!==tagName){var type=element.attributes.type;if(!type||"checkbox"!==type.value&&"radio"!==type.value||element.checked){var values=[];if("select"===tagName)for(var opt,j=0;j<element.options.length;j++)(opt=element.options[j]).selected&&!opt.disabled&&values.push(opt.hasAttribute("value")?opt.value:opt.text);else values.push(element.value);for(var k=0;k<values.length;k++)requestParams.push({name:encodeURIComponent(element.name),value:encodeURIComponent(values[k])})}}}return requestParams}(el),el.setAttribute("data-pjax-state","submit"),options.triggerElement=el,this.loadUrl(virtLinkElement.href,options))}};var isDefaultPrevented=function(event){return event.defaultPrevented||!1===event.returnValue};module.exports=function(el){var that=this;el.setAttribute("data-pjax-state",""),on(el,"submit",(function(event){formAction.call(that,el,event)}))}},{"../events/on":3,"../util/clone":18}],10:[function(require,module,exports){var on=require("../events/on"),clone=require("../util/clone"),attrState="data-pjax-state",linkAction=function(el,event){if(!isDefaultPrevented(event)){var options=clone(this.options),attrValue=function checkIfShouldAbort(el,event){if(event.which>1||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey)return"modifier";if(el.protocol!==window.location.protocol||el.host!==window.location.host)return"external";if(el.hash&&el.href.replace(el.hash,"")===window.location.href.replace(location.hash,""))return"anchor";if(el.href===window.location.href.split("#")[0]+"#")return"anchor-empty"}(el,event);if(attrValue)el.setAttribute(attrState,attrValue);else{if(event.preventDefault(),this.options.currentUrlFullReload&&el.href===window.location.href.split("#")[0])return el.setAttribute(attrState,"reload"),void this.reload();el.setAttribute(attrState,"load"),options.triggerElement=el,this.loadUrl(el.href,options)}}};var isDefaultPrevented=function(event){return event.defaultPrevented||!1===event.returnValue};module.exports=function(el){var that=this;el.setAttribute(attrState,""),on(el,"click",(function(event){linkAction.call(that,el,event)})),on(el,"keyup",function(event){13===event.keyCode&&linkAction.call(that,el,event)}.bind(this))}},{"../events/on":3,"../util/clone":18}],11:[function(require,module,exports){var clone=require("../util/clone"),newUid=require("../uniqueid"),trigger=require("../events/trigger");module.exports=function(responseText,request,href,options){if((options=clone(options||this.options)).request=request,!1!==responseText){var currentState=window.history.state||{};window.history.replaceState({url:currentState.url||window.location.href,title:currentState.title||document.title,uid:currentState.uid||newUid(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var oldHref=href;request.responseURL?href!==request.responseURL&&(href=request.responseURL):request.getResponseHeader("X-PJAX-URL")?href=request.getResponseHeader("X-PJAX-URL"):request.getResponseHeader("X-XHR-Redirected-To")&&(href=request.getResponseHeader("X-XHR-Redirected-To"));var a=document.createElement("a");a.href=oldHref;var oldHash=a.hash;a.href=href,oldHash&&!a.hash&&(a.hash=oldHash,href=a.href),this.state.href=href,this.state.options=options;try{this.loadContent(responseText,options)}catch(e){if(trigger(document,"pjax:error",options),this.options.debug)throw e;return console&&console.error&&console.error("Pjax switch fail: ",e),this.latestChance(href)}}else trigger(document,"pjax:complete pjax:error",options)}},{"../events/trigger":4,"../uniqueid":17,"../util/clone":18}],12:[function(require,module,exports){module.exports=function(){this.options.debug&&console&&("function"==typeof console.log?console.log.apply(console,arguments):console.log&&console.log(arguments))}},{}],13:[function(require,module,exports){module.exports=function(el){switch(el.tagName.toLowerCase()){case"a":el.hasAttribute("data-pjax-state")||this.attachLink(el);break;case"form":el.hasAttribute("data-pjax-state")||this.attachForm(el);break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],14:[function(require,module,exports){var updateQueryString=require("./util/update-query-string");module.exports=function(location,options,callback){var queryString,requestOptions=(options=options||{}).requestOptions||{},requestMethod=(requestOptions.requestMethod||"GET").toUpperCase(),requestParams=requestOptions.requestParams||null,formData=requestOptions.formData||null,requestPayload=null,request=new XMLHttpRequest,timeout=options.timeout||0;if(request.onreadystatechange=function(){4===request.readyState&&(200===request.status?callback(request.responseText,request,location,options):0!==request.status&&callback(null,request,location,options))},request.onerror=function(e){console.log(e),callback(null,request,location,options)},request.ontimeout=function(){callback(null,request,location,options)},requestParams&&requestParams.length)switch(queryString=requestParams.map((function(param){return param.name+"="+param.value})).join("&"),requestMethod){case"GET":location=location.split("?")[0],location+="?"+queryString;break;case"POST":requestPayload=queryString}else formData&&(requestPayload=formData);return options.cacheBust&&(location=updateQueryString(location,"t",Date.now())),request.open(requestMethod,location,!0),request.timeout=timeout,request.setRequestHeader("X-Requested-With","XMLHttpRequest"),request.setRequestHeader("X-PJAX","true"),request.setRequestHeader("X-PJAX-Selectors",JSON.stringify(options.selectors)),requestPayload&&"POST"===requestMethod&&!formData&&request.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),request.send(requestPayload),request}},{"./util/update-query-string":22}],15:[function(require,module,exports){var forEachEls=require("./foreach-els"),defaultSwitches=require("./switches");module.exports=function(switches,switchesOptions,selectors,fromEl,toEl,options){var switchesQueue=[];selectors.forEach((function(selector){var newEls=fromEl.querySelectorAll(selector),oldEls=toEl.querySelectorAll(selector);if(this.log&&this.log("Pjax switch",selector,newEls,oldEls),newEls.length!==oldEls.length)throw"DOM doesn’t look the same on new loaded page: ’"+selector+"’ - new "+newEls.length+", old "+oldEls.length;forEachEls(newEls,(function(newEl,i){var oldEl=oldEls[i];this.log&&this.log("newEl",newEl,"oldEl",oldEl);var callback=switches[selector]?switches[selector].bind(this,oldEl,newEl,options,switchesOptions[selector]):defaultSwitches.outerHTML.bind(this,oldEl,newEl,options);switchesQueue.push(callback)}),this)}),this),this.state.numPendingSwitches=switchesQueue.length,switchesQueue.forEach((function(queuedSwitch){queuedSwitch()}))}},{"./foreach-els":5,"./switches":16}],16:[function(require,module,exports){var on=require("./events/on");module.exports={outerHTML:function(oldEl,newEl){oldEl.outerHTML=newEl.outerHTML,this.onSwitch()},innerHTML:function(oldEl,newEl){oldEl.innerHTML=newEl.innerHTML,""===newEl.className&&oldEl.removeAttribute("class"),this.onSwitch()},switchElementsAlt:function(oldEl,newEl){if(oldEl.innerHTML=newEl.innerHTML,newEl.hasAttributes())for(var attrs=newEl.attributes,i=0;i<attrs.length;i++)oldEl.attributes.setNamedItem(attrs[i].cloneNode());this.onSwitch()},replaceNode:function(oldEl,newEl){oldEl.parentNode.replaceChild(newEl,oldEl),this.onSwitch()},sideBySide:function(oldEl,newEl,options,switchOptions){var forEach=Array.prototype.forEach,elsToRemove=[],elsToAdd=[],fragToAppend=document.createDocumentFragment(),animationEventNames="animationend webkitAnimationEnd MSAnimationEnd oanimationend",animatedElsNumber=0,sexyAnimationEnd=function(e){e.target===e.currentTarget&&--animatedElsNumber<=0&&elsToRemove&&(elsToRemove.forEach((function(el){el.parentNode&&el.parentNode.removeChild(el)})),elsToAdd.forEach((function(el){el.className=el.className.replace(el.getAttribute("data-pjax-classes"),""),el.removeAttribute("data-pjax-classes")})),elsToAdd=null,elsToRemove=null,this.onSwitch())}.bind(this);switchOptions=switchOptions||{},forEach.call(oldEl.childNodes,(function(el){elsToRemove.push(el),el.classList&&!el.classList.contains("js-Pjax-remove")&&(el.hasAttribute("data-pjax-classes")&&(el.className=el.className.replace(el.getAttribute("data-pjax-classes"),""),el.removeAttribute("data-pjax-classes")),el.classList.add("js-Pjax-remove"),switchOptions.callbacks&&switchOptions.callbacks.removeElement&&switchOptions.callbacks.removeElement(el),switchOptions.classNames&&(el.className+=" "+switchOptions.classNames.remove+" "+(options.backward?switchOptions.classNames.backward:switchOptions.classNames.forward)),animatedElsNumber++,on(el,animationEventNames,sexyAnimationEnd,!0))})),forEach.call(newEl.childNodes,(function(el){if(el.classList){var addClasses="";switchOptions.classNames&&(addClasses=" js-Pjax-add "+switchOptions.classNames.add+" "+(options.backward?switchOptions.classNames.forward:switchOptions.classNames.backward)),switchOptions.callbacks&&switchOptions.callbacks.addElement&&switchOptions.callbacks.addElement(el),el.className+=addClasses,el.setAttribute("data-pjax-classes",addClasses),elsToAdd.push(el),fragToAppend.appendChild(el),animatedElsNumber++,on(el,animationEventNames,sexyAnimationEnd,!0)}})),oldEl.className=newEl.className,oldEl.appendChild(fragToAppend)}}},{"./events/on":3}],17:[function(require,module,exports){var counter;module.exports=(counter=0,function(){var id="pjax"+(new Date).getTime()+"_"+counter;return counter++,id})},{}],18:[function(require,module,exports){module.exports=function(obj){if(null===obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&(copy[attr]=obj[attr]);return copy}},{}],19:[function(require,module,exports){module.exports=function contains(doc,selectors,el){for(var i=0;i<selectors.length;i++)for(var selectedEls=doc.querySelectorAll(selectors[i]),j=0;j<selectedEls.length;j++)if(selectedEls[j].contains(el))return!0;return!1}},{}],20:[function(require,module,exports){module.exports=function(target){if(null==target)return null;for(var to=Object(target),i=1;i<arguments.length;i++){var source=arguments[i];if(null!=source)for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(to[key]=source[key])}return to}},{}],21:[function(require,module,exports){module.exports=function(){}},{}],22:[function(require,module,exports){module.exports=function(uri,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=-1!==uri.indexOf("?")?"&":"?";return uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value}},{}]},{},[1])(1)}));